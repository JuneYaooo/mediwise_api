# MediWise API æ¥å£æ–‡æ¡£

**ç‰ˆæœ¬**: 1.0.0
**Base URL**: `http://182.254.240.153:9527`
**è®¤è¯æ–¹å¼**: æš‚æ— éœ€è®¤è¯

---

## ç›®å½•

- [1. æ‚£è€…æ•°æ®å¤„ç†æ¥å£](#1-æ‚£è€…æ•°æ®å¤„ç†æ¥å£)
  - [1.1 æ··åˆæ™ºèƒ½å¤„ç†](#11-æ··åˆæ™ºèƒ½å¤„ç†)
  - [1.2 æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€](#12-æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€)
- [2. æ‚£è€… PPT ç”Ÿæˆæ¥å£](#2-æ‚£è€…-ppt-ç”Ÿæˆæ¥å£)
  - [2.1 ç”Ÿæˆæ‚£è€… PPT](#21-ç”Ÿæˆæ‚£è€…-ppt)
  - [2.2 è·å–æ‚£è€… PPT æ•°æ®](#22-è·å–æ‚£è€…-ppt-æ•°æ®)
- [3. æµ‹è¯•è„šæœ¬ä½¿ç”¨è¯´æ˜](#3-æµ‹è¯•è„šæœ¬ä½¿ç”¨è¯´æ˜)
  - [3.1 test_flow_simple.py](#31-test_flow_simplepy)
  - [3.2 test_ppt_api.py](#32-test_ppt_apipy)

---

## 1. æ‚£è€…æ•°æ®å¤„ç†æ¥å£

### 1.1 æ··åˆæ™ºèƒ½å¤„ç†

**æ¥å£**: `POST /api/patient_data/process_patient_data_smart`

**åŠŸèƒ½è¯´æ˜**:
- å¤„ç†æ‚£è€…ç—…å†æ–‡ä»¶ï¼Œæå–ç»“æ„åŒ–æ•°æ®ï¼ˆæ‚£è€…æ—¶é—´è½´ã€è¯Šç–—å†ç¨‹ç­‰ï¼‰
- æ”¯æŒæµå¼å“åº”ï¼ˆServer-Sent Eventsï¼‰ï¼Œå®æ—¶è¿”å›å¤„ç†è¿›åº¦
- æ”¯æŒå®¢æˆ·ç«¯æ–­å¼€ååå°ç»§ç»­æ‰§è¡Œ
- ç”Ÿæˆ `patient_id` å’Œ `conversation_id`ï¼Œç”¨äºåç»­ PPT ç”Ÿæˆ

**è¯·æ±‚æ–¹å¼**: `POST`

**Content-Type**: `application/json`

**è¯·æ±‚å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| patient_description | string | æ˜¯ | æ‚£è€…è¯´æ˜æ–‡æœ¬ï¼Œæè¿°æ‚£è€…åŸºæœ¬æƒ…å†µ |
| consultation_purpose | string | æ˜¯ | ä¼šè¯Šç›®çš„ï¼Œè¯´æ˜æœ¬æ¬¡å¤„ç†çš„ç›®æ ‡ |
| files | array | æ˜¯ | æ–‡ä»¶åˆ—è¡¨ï¼Œè‡³å°‘åŒ…å«ä¸€ä¸ªæ–‡ä»¶ |
| files[].file_name | string | æ˜¯ | æ–‡ä»¶åï¼ˆå«æ‰©å±•åï¼‰ |
| files[].file_content | string | æ˜¯ | æ–‡ä»¶å†…å®¹ï¼ˆBase64 ç¼–ç ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "patient_description": "æ‚£è€…æäº‘å±±çš„å®Œæ•´ç—…ä¾‹èµ„æ–™ï¼ŒåŒ…å«å¤šæ¬¡æ£€æŸ¥æŠ¥å‘Šå’Œå½±åƒèµ„æ–™",
  "consultation_purpose": "å¤šå­¦ç§‘ä¼šè¯Šï¼Œåˆ¶å®šç»¼åˆæ²»ç–—æ–¹æ¡ˆï¼Œè¯„ä¼°é¢„åæƒ…å†µ",
  "files": [
    {
      "file_name": "æ£€æŸ¥æŠ¥å‘Š.pdf",
      "file_content": "JVBERi0xLjQKJeLjz9MKMSAwIG9iago8PC9UeXBlL0NhdGFsb..."
    },
    {
      "file_name": "å½±åƒèµ„æ–™.jpg",
      "file_content": "/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJ..."
    }
  ]
}
```

**å“åº”æ ¼å¼**: `text/event-stream` (Server-Sent Events)

**æµå¼å“åº”ç¤ºä¾‹**:

```
data: {"task_id": "uuid-xxx-xxx", "status": "started", "message": "å¼€å§‹å¤„ç†æ‚£è€…æ•°æ®", "progress": 0}

data: {"status": "processing", "stage": "file_processing", "message": "æ­£åœ¨å¤„ç† 2 ä¸ªæ–‡ä»¶", "progress": 10}

data: {"status": "processing", "stage": "file_processing_completed", "message": "æ–‡ä»¶å¤„ç†å®Œæˆï¼Œå…±æå– 2 ä¸ªæ–‡ä»¶", "progress": 25}

data: {"status": "processing", "stage": "patient_data_structuring", "message": "æ­£åœ¨è¿›è¡Œæ‚£è€…æ•°æ®ç»“æ„åŒ–å¤„ç†", "progress": 30}

data: {"status": "completed", "message": "æ‚£è€…æ•°æ®å¤„ç†å®Œæˆ", "progress": 100, "duration": 123.45, "result": {...}}
```

**å®Œæˆæ—¶çš„ result å­—æ®µ**:

```json
{
  "patient_id": "æ‚£è€…å”¯ä¸€ID",
  "conversation_id": "ä¼šè¯ID",
  "uploaded_files_count": 2,
  "uploaded_file_ids": ["file_id_1", "file_id_2"],
  "patient_timeline": {
    "åŸºæœ¬ä¿¡æ¯": {...},
    "æ—¶é—´è½´": [...]
  },
  "patient_journey": {
    "è¯Šç–—å†ç¨‹": [...]
  },
  "mdt_simple_report": {
    "MDTç®€æŠ¥": {...}
  },
  "patient_full_content": "æ‚£è€…å®Œæ•´å†…å®¹æ–‡æœ¬"
}
```

**é”™è¯¯å“åº”**:

```json
{
  "status": "error",
  "message": "å¤„ç†å¤±è´¥: å…·ä½“é”™è¯¯ä¿¡æ¯",
  "error": "é”™è¯¯è¯¦æƒ…"
}
```

**HTTP çŠ¶æ€ç **:
- `200`: æˆåŠŸå»ºç«‹æµå¼è¿æ¥
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

**ä½¿ç”¨è¯´æ˜**:
1. å®¢æˆ·ç«¯å¯ä»¥ä¸­é€”æ–­å¼€è¿æ¥ï¼Œåå°ä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œ
2. ç¬¬ä¸€æ¡æ¶ˆæ¯ä¸­åŒ…å« `task_id`ï¼Œå®¢æˆ·ç«¯åº”ä¿å­˜æ­¤ ID
3. å¦‚éœ€æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ï¼Œä½¿ç”¨ `task_id` è°ƒç”¨çŠ¶æ€æŸ¥è¯¢æ¥å£

---

### 1.2 æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

**æ¥å£**: `GET /api/patient_data/task_status/{task_id}`

**åŠŸèƒ½è¯´æ˜**:
- æŸ¥è¯¢åå°ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦
- è·å–å·²å®Œæˆä»»åŠ¡çš„ç»“æœæ•°æ®

**è¯·æ±‚æ–¹å¼**: `GET`

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| task_id | string | æ˜¯ | ä»»åŠ¡IDï¼ˆä»æµå¼æ¥å£è¿”å›ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
GET /api/patient_data/task_status/uuid-xxx-xxx
```

**å“åº”ç¤ºä¾‹**:

**å¤„ç†ä¸­**:
```json
{
  "status": "processing",
  "progress": 45,
  "message": "æ­£åœ¨è¿›è¡Œæ‚£è€…æ•°æ®ç»“æ„åŒ–å¤„ç†",
  "stage": "patient_data_structuring"
}
```

**å·²å®Œæˆ**:
```json
{
  "status": "completed",
  "progress": 100,
  "message": "æ‚£è€…æ•°æ®å¤„ç†å®Œæˆ",
  "duration": 123.45,
  "result": {
    "patient_id": "æ‚£è€…ID",
    "conversation_id": "ä¼šè¯ID",
    "uploaded_files_count": 2,
    "patient_timeline": {...},
    "patient_journey": {...},
    "mdt_simple_report": {...},
    "patient_full_content": "..."
  }
}
```

**å¤±è´¥**:
```json
{
  "status": "error",
  "message": "å¤„ç†å¤±è´¥: æ–‡ä»¶è§£æé”™è¯¯",
  "error": "å…·ä½“é”™è¯¯ä¿¡æ¯",
  "duration": 10.5
}
```

**HTTP çŠ¶æ€ç **:
- `200`: æˆåŠŸè·å–ä»»åŠ¡çŠ¶æ€
- `404`: ä»»åŠ¡ä¸å­˜åœ¨

---

## 2. æ‚£è€… PPT ç”Ÿæˆæ¥å£

### 2.1 ç”Ÿæˆæ‚£è€… PPT

**æ¥å£**: `POST /api/patients/{patient_id}/generate_ppt`

**åŠŸèƒ½è¯´æ˜**:
- åŸºäºæ‚£è€…çš„æ‰€æœ‰ç»“æ„åŒ–æ•°æ®ç”ŸæˆåŒ»ç–—ä¼šè¯Š PPT
- è‡ªåŠ¨èšåˆæ‚£è€…çš„æ—¶é—´è½´ã€è¯Šç–—å†ç¨‹ã€MDT æŠ¥å‘Šç­‰æ•°æ®
- ä»æ•°æ®åº“è·å–æ‰€æœ‰å…³è”çš„åŸå§‹æ–‡ä»¶
- ç”ŸæˆåŒ…å«æ‚£è€…å®Œæ•´ç—…å†çš„ PPT æ–‡ä»¶

**è¯·æ±‚æ–¹å¼**: `POST`

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| patient_id | string | æ˜¯ | æ‚£è€…IDï¼ˆä»æ•°æ®å¤„ç†æ¥å£è¿”å›ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
POST /api/patients/patient_uuid_xxx/generate_ppt
```

**è¯·æ±‚ Body**: æ— éœ€æä¾›

**å“åº”ç¤ºä¾‹**:

**æˆåŠŸ**:
```json
{
  "success": true,
  "ppt_url": "https://suvalue.com/ppt/xxx",
  "local_path": "/app/output/patient_uuid_xxx/medical_ppt.pptx",
  "file_uuid": "file_uuid_xxx",
  "qiniu_url": "https://cdn.qiniu.com/xxx.pptx",
  "message": "PPTç”ŸæˆæˆåŠŸ",
  "patient_info": {
    "patient_id": "patient_uuid_xxx",
    "name": "æäº‘å±±",
    "created_at": "2025-01-01 10:00:00"
  }
}
```

**å¤±è´¥**:
```json
{
  "success": false,
  "error": "æ‚£è€…æ—¶é—´è½´æ•°æ®ä¸ºç©ºï¼Œæ— æ³•ç”ŸæˆPPT",
  "detail": "è¯·å…ˆå¤„ç†æ‚£è€…æ•°æ®"
}
```

**HTTP çŠ¶æ€ç **:
- `200`: æˆåŠŸç”Ÿæˆ PPT
- `400`: æ‚£è€…æ•°æ®ä¸å®Œæ•´ï¼Œæ— æ³•ç”Ÿæˆ
- `404`: æ‚£è€…ä¸å­˜åœ¨
- `500`: PPT ç”Ÿæˆå¤±è´¥

**è¯´æ˜**:
- æœ¬æ¥å£å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆé€šå¸¸ 1-5 åˆ†é’Ÿï¼‰
- å»ºè®®è®¾ç½®è¾ƒé•¿çš„è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆå¦‚ 300 ç§’ï¼‰
- è¿”å›çš„ URL ç±»å‹å–å†³äºé…ç½®ï¼š
  - `ppt_url`: Suvalue API æ¨¡å¼çš„ PPT é“¾æ¥
  - `qiniu_url`: æœ¬åœ°ç”Ÿæˆ + ä¸ƒç‰›äº‘ä¸Šä¼ çš„é“¾æ¥
  - `local_path`: æœ¬åœ°æ–‡ä»¶è·¯å¾„

---

### 2.2 è·å–æ‚£è€… PPT æ•°æ®

**æ¥å£**: `GET /api/patients/{patient_id}/ppt_data`

**åŠŸèƒ½è¯´æ˜**:
- è·å–æ‚£è€…ç”¨äºç”Ÿæˆ PPT çš„æ‰€æœ‰æ•°æ®
- ç”¨äºé¢„è§ˆã€è°ƒè¯•æˆ–éªŒè¯æ•°æ®å®Œæ•´æ€§
- ä¸ä¼šç”Ÿæˆ PPTï¼Œä»…è¿”å›æ•°æ®

**è¯·æ±‚æ–¹å¼**: `GET`

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| patient_id | string | æ˜¯ | æ‚£è€…ID |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
GET /api/patients/patient_uuid_xxx/ppt_data
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "data": {
    "patient_info": {
      "patient_id": "patient_uuid_xxx",
      "name": "æäº‘å±±",
      "gender": "ç”·",
      "age": 65
    },
    "patient_timeline": {
      "åŸºæœ¬ä¿¡æ¯": {...},
      "æ—¶é—´è½´": [
        {
          "æ—¥æœŸ": "2024-01-01",
          "äº‹ä»¶": "åˆè¯Š",
          "è¯¦æƒ…": "..."
        }
      ]
    },
    "patient_journey": {
      "è¯Šç–—å†ç¨‹": [...]
    },
    "mdt_reports": [
      {
        "æ—¥æœŸ": "2024-01-15",
        "ç±»å‹": "MDTè®¨è®º",
        "å†…å®¹": "..."
      }
    ],
    "raw_files_data": [
      {
        "file_id": "file_1",
        "file_name": "æ£€æŸ¥æŠ¥å‘Š.pdf",
        "source_type": "pdf",
        "file_size": 1024000
      }
    ]
  }
}
```

**HTTP çŠ¶æ€ç **:
- `200`: æˆåŠŸè·å–æ•°æ®
- `404`: æ‚£è€…ä¸å­˜åœ¨
- `500`: æŸ¥è¯¢å¤±è´¥

---

## 3. æµ‹è¯•è„šæœ¬ä½¿ç”¨è¯´æ˜

### 3.1 test_flow_simple.py

**åŠŸèƒ½**: æµ‹è¯•æ‚£è€…æ•°æ®å¤„ç†æµç¨‹ï¼ˆæ”¯æŒæ–­å¼€é‡è¿ï¼‰

**ä½¿ç”¨æ–¹æ³•**:

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•æµç¨‹
python tests/test_flow_simple.py
```

**æµ‹è¯•æµç¨‹**:
1. ä»æŒ‡å®šç›®å½•åŠ è½½æ‚£è€…ç—…å†æ–‡ä»¶ï¼ˆé»˜è®¤ 5 ä¸ªæ–‡ä»¶ï¼‰
2. è°ƒç”¨ `process_patient_data_smart` æ¥å£å¼€å§‹å¤„ç†
3. æ¥æ”¶æµå¼å“åº”ï¼Œæ˜¾ç¤ºå¤„ç†è¿›åº¦
4. æ¥æ”¶ 5 æ¡æ¶ˆæ¯åä¸»åŠ¨æ–­å¼€è¿æ¥ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·å…³é—­æµè§ˆå™¨ï¼‰
5. ç­‰å¾… 10 ç§’åå¼€å§‹è½®è¯¢ä»»åŠ¡çŠ¶æ€
6. æ¯ 5 ç§’æŸ¥è¯¢ä¸€æ¬¡ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–å¤±è´¥
7. è¾“å‡º `patient_id`ï¼Œç”¨äºåç»­ PPT ç”Ÿæˆ

**å…³é”®é…ç½®**:

```python
# é…ç½®æ–‡ä»¶è·¯å¾„
CASE_DIR = "/home/ubuntu/data/patient_case/liyunshan/"

# API åœ°å€
API_BASE_URL = "http://182.254.240.153:9527"

# æœ€å¤§æ–‡ä»¶æ•°
max_files = 5

# æ¥æ”¶æ¶ˆæ¯æ•°é‡åæ–­å¼€
max_events = 5
```

**è¾“å‡ºç¤ºä¾‹**:

```
================================================================================
ğŸ“± æµ‹è¯•åœºæ™¯ï¼šå®¢æˆ·ç«¯ä¸­é€”æ–­å¼€ï¼ˆåå°ç»§ç»­æ‰§è¡Œï¼‰
================================================================================

ğŸ“¤ å‘é€è¯·æ±‚... (2025-01-01 10:00:00)

âœ… è¿æ¥æˆåŠŸï¼Œå¼€å§‹æ¥æ”¶æµå¼å“åº”...
--------------------------------------------------------------------------------
ğŸ†” ä»»åŠ¡ID: uuid-xxx-xxx
ğŸ’¡ å°†åœ¨æ¥æ”¶5æ¡æ¶ˆæ¯åä¸»åŠ¨æ–­å¼€

ğŸš€ [1] 2025-01-01 10:00:01 | å¼€å§‹å¤„ç†æ‚£è€…æ•°æ®
â³ [2] 2025-01-01 10:00:05 | è¿›åº¦ 10% - æ­£åœ¨å¤„ç† 5 ä¸ªæ–‡ä»¶
â³ [3] 2025-01-01 10:00:15 | è¿›åº¦ 25% - æ–‡ä»¶å¤„ç†å®Œæˆï¼Œå…±æå– 5 ä¸ªæ–‡ä»¶
â³ [4] 2025-01-01 10:00:20 | è¿›åº¦ 30% - æ­£åœ¨è¿›è¡Œæ‚£è€…æ•°æ®ç»“æ„åŒ–å¤„ç†
â³ [5] 2025-01-01 10:00:30 | è¿›åº¦ 45% - åˆ†ææ‚£è€…åŸºæœ¬ä¿¡æ¯

ğŸ”Œ [5] 2025-01-01 10:00:30 | ä¸»åŠ¨æ–­å¼€è¿æ¥ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·å…³é—­æµè§ˆå™¨ï¼‰
   ğŸ’¡ åå°ä»»åŠ¡åº”è¯¥ç»§ç»­æ‰§è¡Œ...

â° ç­‰å¾…10ç§’ï¼Œæ¨¡æ‹Ÿç”¨æˆ·ç¨åé‡æ–°æ‰“å¼€...

ğŸ” æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€... (2025-01-01 10:00:40)

ğŸ“Š [1] 2025-01-01 10:00:40 | çŠ¶æ€: processing | è¿›åº¦: 60% | æå–æ²»ç–—æ–¹æ¡ˆ
ğŸ“Š [2] 2025-01-01 10:00:45 | çŠ¶æ€: processing | è¿›åº¦: 80% | ç”Ÿæˆæ‚£è€…æ—¶é—´è½´
ğŸ“Š [3] 2025-01-01 10:00:50 | çŠ¶æ€: completed | è¿›åº¦: 100% | æ‚£è€…æ•°æ®å¤„ç†å®Œæˆ

âœ… ä»»åŠ¡å®Œæˆï¼
   - æ‚£è€…ID: patient_uuid_xxx
   - ä¼šè¯ID: conversation_uuid_xxx
   - å¤„ç†æ–‡ä»¶æ•°: 5
   ğŸ“Š åå°ä»»åŠ¡æˆåŠŸå®Œæˆï¼Œå³ä½¿å®¢æˆ·ç«¯æ–­å¼€äº†ï¼

================================================================================
ğŸ†” æ‚£è€…IDï¼ˆç”¨äºç”ŸæˆPPTï¼‰:
--------------------------------------------------------------------------------
   patient_uuid_xxx
--------------------------------------------------------------------------------
ğŸ’¡ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”ŸæˆPPT:
   python test_ppt_api.py patient_uuid_xxx generate
================================================================================
```

---

### 3.2 test_ppt_api.py

**åŠŸèƒ½**: æµ‹è¯•æ‚£è€… PPT ç”Ÿæˆæ¥å£

**ä½¿ç”¨æ–¹æ³•**:

**æ–¹å¼ 1: è‡ªåŠ¨é€‰æ‹©æœ€è¿‘çš„æ‚£è€…**

```bash
# æŸ¥è¯¢æœ€è¿‘çš„æ‚£è€…å¹¶æµ‹è¯•è·å– PPT æ•°æ®
python tests/test_ppt_api.py
```

**æ–¹å¼ 2: æŒ‡å®šæ‚£è€…ID**

```bash
# åªæŸ¥è¯¢ PPT æ•°æ®
python tests/test_ppt_api.py patient_uuid_xxx

# æŸ¥è¯¢æ•°æ® + ç”Ÿæˆ PPT
python tests/test_ppt_api.py patient_uuid_xxx generate
```

**æµ‹è¯•æµç¨‹**:

1. **æµ‹è¯• 1: è·å–æ‚£è€… PPT æ•°æ®**
   - è°ƒç”¨ `GET /api/patients/{patient_id}/ppt_data`
   - æ˜¾ç¤ºæ‚£è€…åŸºæœ¬ä¿¡æ¯ã€æ–‡ä»¶æ•°é‡ã€æ•°æ®å®Œæ•´æ€§

2. **æµ‹è¯• 2: ç”Ÿæˆæ‚£è€… PPT**ï¼ˆä»…åœ¨ä½¿ç”¨ `generate` å‚æ•°æ—¶ï¼‰
   - è°ƒç”¨ `POST /api/patients/{patient_id}/generate_ppt`
   - ç­‰å¾… PPT ç”Ÿæˆå®Œæˆï¼ˆæœ€é•¿ 5 åˆ†é’Ÿï¼‰
   - æ˜¾ç¤º PPT URL æˆ–æœ¬åœ°è·¯å¾„

**è¾“å‡ºç¤ºä¾‹**:

```
============================================================
ğŸ¥ MediWise PPT API æµ‹è¯•å·¥å…·
============================================================

============================================================
ğŸ‘¥ æŸ¥è¯¢æœ€è¿‘çš„æ‚£è€…åˆ—è¡¨
============================================================

æ‰¾åˆ° 3 ä¸ªæ‚£è€…:

1. ID: patient_uuid_1
   å§“å: æäº‘å±±
   åˆ›å»ºæ—¶é—´: 2025-01-01 10:00:00

2. ID: patient_uuid_2
   å§“å: å¼ ä¸‰
   åˆ›å»ºæ—¶é—´: 2025-01-01 09:00:00

3. ID: patient_uuid_3
   å§“å: ç‹äº”
   åˆ›å»ºæ—¶é—´: 2025-01-01 08:00:00

ä½¿ç”¨æœ€è¿‘çš„æ‚£è€…: patient_uuid_1

============================================================
ğŸ“Š æµ‹è¯• 1: è·å–æ‚£è€… PPT æ•°æ®
============================================================
è¯·æ±‚ URL: http://localhost:9527/api/patients/patient_uuid_1/ppt_data
çŠ¶æ€ç : 200

âœ… æŸ¥è¯¢æˆåŠŸï¼
  æ‚£è€…å§“å: æäº‘å±±
  æ‚£è€…ID: patient_uuid_1
  æ–‡ä»¶æ€»æ•°: 5 ä¸ª
  Timeline: âœ… æœ‰
  Journey: âœ… æœ‰
  MDTæŠ¥å‘Š: 2 ä¸ª

  å‰3ä¸ªæ–‡ä»¶:
    1. æ£€æŸ¥æŠ¥å‘Š.pdf (pdf)
    2. å½±åƒèµ„æ–™.jpg (image)
    3. è¯Šæ–­ä¹¦.pdf (pdf)

æç¤ºï¼šå¦‚éœ€æµ‹è¯•ç”Ÿæˆ PPTï¼Œè¯·è¿è¡Œ:
  python test_ppt_api.py patient_uuid_1 generate

============================================================
æµ‹è¯•å®Œæˆï¼
============================================================
```

**ç”Ÿæˆ PPT æ—¶çš„è¾“å‡º**:

```
============================================================
ğŸ“„ æµ‹è¯• 2: ç”Ÿæˆæ‚£è€… PPT
============================================================
è¯·æ±‚ URL: http://localhost:9527/api/patients/patient_uuid_1/generate_ppt
âš ï¸  æ³¨æ„ï¼šPPT ç”Ÿæˆå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´...
çŠ¶æ€ç : 200

âœ… PPT ç”ŸæˆæˆåŠŸï¼
  PPT URL: https://cdn.qiniu.com/patient_uuid_1_medical_ppt.pptx
  æœ¬åœ°è·¯å¾„: /app/output/patient_uuid_1/medical_ppt.pptx

============================================================
æµ‹è¯•å®Œæˆï¼
============================================================
```

---

## 4. å¸¸è§é—®é¢˜

### 4.1 å¦‚ä½•è·å– patient_idï¼Ÿ

è¿è¡Œ `test_flow_simple.py` å¤„ç†æ‚£è€…æ•°æ®åï¼Œä¼šè¾“å‡º `patient_id`ã€‚å¤åˆ¶è¯¥ ID ç”¨äºç”Ÿæˆ PPTã€‚

### 4.2 æ–‡ä»¶æ”¯æŒå“ªäº›æ ¼å¼ï¼Ÿ

æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š
- PDF: `.pdf`
- å›¾ç‰‡: `.jpg`, `.jpeg`, `.png`

### 4.3 PPT ç”Ÿæˆéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ

é€šå¸¸ 1-5 åˆ†é’Ÿï¼Œå–å†³äºï¼š
- æ–‡ä»¶æ•°é‡å’Œå¤§å°
- æ•°æ®å¤æ‚åº¦
- æœåŠ¡å™¨æ€§èƒ½

### 4.4 å¦‚ä½•å¤„ç†è¶…æ—¶ï¼Ÿ

å»ºè®®è®¾ç½® HTTP å®¢æˆ·ç«¯è¶…æ—¶ä¸º 300 ç§’ï¼ˆ5 åˆ†é’Ÿï¼‰ï¼š

```python
response = requests.post(url, timeout=300)
```

### 4.5 å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªæ‚£è€…å—ï¼Ÿ

å¯ä»¥ã€‚æ¯ä¸ªæ‚£è€…çš„å¤„ç†ä»»åŠ¡æ˜¯ç‹¬ç«‹çš„ï¼Œä½¿ç”¨ä¸åŒçš„ `task_id` å’Œ `patient_id`ã€‚

---

## 5. å¼€å‘è€…å¤‡æ³¨

- æ‰€æœ‰æ¥å£å‡ä½äº `/api/patient_data/` å’Œ `/api/patients/` è·¯å¾„ä¸‹
- ä»»åŠ¡çŠ¶æ€å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒæœåŠ¡é‡å¯åä¼šä¸¢å¤±
- å½“å‰ç‰ˆæœ¬æš‚æ— éœ€è®¤è¯ï¼Œåç»­ç‰ˆæœ¬å°†åŠ å…¥è®¤è¯æœºåˆ¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-01-22
